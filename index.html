<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GM Ritual Dashboard</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #ffffff, #e8f1ff);
      font-family: "Inter", sans-serif;
      color: #333;
      text-align: center;
    }

    #walletBar {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 999;
    }

    .walletBtn {
      padding: 10px 18px;
      border-radius: 8px;
      background: #0052ff;
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: 0.2s;
    }

    .walletBtn:hover {
      background: #003bcc;
    }

    #walletMenu {
      display: none;
      background: #fff;
      padding: 10px;
      border-radius: 10px;
      margin-top: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      min-width: 170px;
    }

    #disconnectBtn {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      background: #ff4d4d;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 5px;
    }

    #disconnectBtn:hover {
      background: #e60000;
    }

    #title {
      padding-top: 100px;
      font-size: 32px;
      font-weight: 700;
      color: #003bcc;
    }

    #buttons {
      margin-top: 40px;
    }

    .ritualBtn {
      padding: 12px 26px;
      margin: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }

    .gm { background: #0080ff; }
    .gn { background: #6639f4; }
    .sleep { background: #333; }

    .gm:hover { background: #0067cc; }
    .gn:hover { background: #512ec2; }
    .sleep:hover { background: #000; }

    #status {
      margin-top: 30px;
      font-size: 18px;
      font-weight: 600;
    }
  </style>
</head>

<body>

  <!-- ‚úÖ Wallet Connect Bar -->
  <div id="walletBar">
    <button id="connectBtn" class="walletBtn">Connect Wallet</button>

    <div id="walletMenu">
      <div id="walletAddr" style="font-size: 14px; margin-bottom: 10px;"></div>
      <button id="disconnectBtn">Disconnect</button>
    </div>
  </div>

  <!-- ‚úÖ Title -->
  <div id="title">GM Ritual Dashboard ‚ö°</div>

  <!-- ‚úÖ Buttons -->
  <div id="buttons">
    <button class="ritualBtn gm" onclick="ritual('GM')">GM Ritual üöÄ</button>
    <button class="ritualBtn gn" onclick="ritual('GN')">GN Ritual üåô</button>
    <button class="ritualBtn sleep" onclick="ritual('GoSleep')">GoSleep Ritual üò¥</button>
  </div>

  <!-- ‚úÖ Status -->
  <div id="status"></div>

  <!-- ‚úÖ Script -->
  <script type="module">
    import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.1/ethers.min.js";

    const contractAddress = "0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A";

    const abi = [
      "function performRitual(string newMessage) payable",
      "function fee() view returns (uint256)"
    ];

    let provider = null;
    let signer = null;
    let connectedAddress = null;

    const connectBtn = document.getElementById("connectBtn");
    const walletMenu = document.getElementById("walletMenu");
    const walletAddr = document.getElementById("walletAddr");
    const disconnectBtn = document.getElementById("disconnectBtn");
    const statusBox = document.getElementById("status");

    function shortAddr(addr) {
      return addr.slice(0, 6) + "..." + addr.slice(-4);
    }

    function updateUI() {
      if (!connectedAddress) {
        connectBtn.innerText = "Connect Wallet";
        walletMenu.style.display = "none";
      } else {
        connectBtn.innerText = "‚úÖ " + shortAddr(connectedAddress);
        walletMenu.style.display = "block";
        walletAddr.innerText = shortAddr(connectedAddress);
      }
    }

    connectBtn.onclick = async function () {
      try {
        if (!window.ethereum) return alert("Install MetaMask or Base Wallet.");
        provider = new ethers.BrowserProvider(window.ethereum);
        const accounts = await ethereum.request({ method: "eth_requestAccounts" });
        signer = await provider.getSigner();
        connectedAddress = accounts[0];

        statusBox.innerText = "üîó Connected";
        updateUI();
      } catch (err) {
        console.error(err);
        alert("Failed to connect wallet");
      }
    };

    disconnectBtn.onclick = function () {
      provider = null;
      signer = null;
      connectedAddress = null;

      statusBox.innerText = "üîå Disconnected";
      updateUI();
    };

    if (window.ethereum) {
      window.ethereum.on("accountsChanged", async (accounts) => {
        if (accounts.length === 0) {
          connectedAddress = null;
          signer = null;
          statusBox.innerText = "üîå Wallet disconnected";
        } else {
          provider = new ethers.BrowserProvider(window.ethereum);
          signer = await provider.getSigner();
          connectedAddress = accounts[0];
        }
        updateUI();
      });
    }

    window.ritual = async function (msg) {
      if (!signer) return alert("Connect wallet first!");

      const contract = new ethers.Contract(contractAddress, abi, signer);

      try {
        const fee = await contract.fee();
        statusBox.innerText = "‚è≥ Sending ritual...";
        
        const tx = await contract.performRitual(msg, { value: fee });
        await tx.wait();

        statusBox.innerText = "‚úÖ Ritual Sent: " + msg;
      } catch (err) {
        console.error(err);
        statusBox.innerText = "‚ùå Ritual Failed";
      }
    };
  </script>

</body>
</html>
