<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GM Ritual Dashboard âš¡</title>
  <style>
    body {
      background: #0f0f0f;
      color: #ffffff;
      text-align: center;
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }
    button {
      width: 80%;
      max-width: 400px;
      padding: 15px;
      margin: 10px auto;
      font-size: 20px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
    }
    #connectBtn {
      background: #1967ff;
      color: #fff;
    }
    #gmBtn {
      background: #1e90ff;
      color: #fff;
    }
    #gnBtn {
      background: #9b59b6;
      color: #fff;
    }
    #sleepBtn {
      background: #555;
      color: #999;
    }
    #deployLink {
      display: block;
      color: #4da6ff;
      margin-top: 40px;
      font-size: 18px;
      text-decoration: none;
    }
  </style>

  <!-- âœ… LOAD SCRIPTS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3modal/1.9.0/web3modal.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider/dist/umd/index.min.js"></script>

</head>
<body>

  <h1>GM Ritual Dashboard âš¡</h1>

  <button id="connectBtn" onclick="connectWallet()">Connect Wallet</button>

  <button id="gmBtn" onclick="gm()" disabled>GM Ritual ðŸŒž</button>
  <button id="gnBtn" onclick="gn()" disabled>GN Ritual ðŸŒ™</button>
  <button id="sleepBtn" onclick="gosleep()" disabled>GoSleep Ritual ðŸ˜´</button>

  <a id="deployLink" href="/deploy">Deploy your contract ðŸš€</a>


<script>

  /* -------------------------------
      âœ… CONFIG
  --------------------------------- */

  const CONTRACT_ADDRESS = "0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A";

  const ABI = [
    "function gm() public",
    "function gn() public",
    "function gosleep() public"
  ];

  let web3Modal;
  let provider;
  let web3Provider;
  let signer;

  /* -------------------------------
      âœ… INIT WHEN PAGE READY
  --------------------------------- */
  window.addEventListener("load", async () => {

    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: {
          rpc: {
            8453: "https://mainnet.base.org"
          },
          chainId: 8453
        }
      }
    };

    web3Modal = new Web3Modal.default({
      cacheProvider: false,
      providerOptions,
      theme: "dark"
    });

    console.log("âœ… Web3Modal loaded");
  });


  /* -------------------------------
      âœ… CONNECT WALLET
  --------------------------------- */
  async function connectWallet() {

    if (!web3Modal) {
      alert("Web3Modal loading... wait 1 sec!");
      return;
    }

    try {
      provider = await web3Modal.connect();

      try {
        await provider.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x2105" }]  // BASE MAINNET
        });
      } catch (switchErr) {
        await provider.request({
          method: "wallet_addEthereumChain",
          params: [{
            chainId: "0x2105",
            chainName: "Base Mainnet",
            nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 },
            rpcUrls: ["https://mainnet.base.org"],
            blockExplorerUrls: ["https://basescan.org"]
          }]
        });
      }

      web3Provider = new ethers.providers.Web3Provider(provider);
      signer = web3Provider.getSigner();

      const address = await signer.getAddress();

      document.getElementById("connectBtn").innerText =
        "âœ… " + address.slice(0, 6) + "..." + address.slice(-4);

      document.getElementById("gmBtn").disabled = false;
      document.getElementById("gnBtn").disabled = false;
      document.getElementById("sleepBtn").disabled = false;

    } catch (error) {
      alert("Connection failed: " + error.message);
    }
  }


  /* -------------------------------
       âœ… GM
  --------------------------------- */
  async function gm() {
    try {
      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      await contract.gm();
      alert("âœ… GM Ritual submitted!");
    } catch (err) {
      alert("Error: " + err.message);
    }
  }

  /* -------------------------------
       âœ… GN
  --------------------------------- */
  async function gn() {
    try {
      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      await contract.gn();
      alert("âœ… GN Ritual submitted!");
    } catch (err) {
      alert("Error: " + err.message);
    }
  }

  /* -------------------------------
      âœ… GOSLEEP
  --------------------------------- */
  async function gosleep() {
    try {
      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      await contract.gosleep();
      alert("âœ… GoSleep Ritual submitted!");
    } catch (err) {
      alert("Error: " + err.message);
    }
  }

</script>

</body>
</html>
