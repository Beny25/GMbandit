<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GM Ritual Dashboard ‚ö°</title>
  <style>
    body { background:#0f0f0f; color:white; text-align:center; font-family:Arial; padding:30px; }
    h1 { font-size:32px; margin-bottom:10px; }
    button { width:80%; max-width:400px; padding:15px; font-size:20px; margin:10px auto; border-radius:12px; border:none; cursor:pointer; }
    button:disabled { opacity:0.4; cursor:not-allowed; }
    #connectBtn { background:#1967ff; color:white; }
    #gmBtn { background:#1e90ff; color:white; }
    #gnBtn { background:#9b59b6; color:white; }
    #sleepBtn { background:#555; color:#999; }
    #deployLink { display:block; color:#4da6ff; margin-top:40px; font-size:18px; text-decoration:none; }
  </style>

  <!-- ‚úÖ ASSET -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3modal/1.9.0/web3modal.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider/dist/umd/index.min.js"></script>
</head>

<body>

<h1>GM Ritual Dashboard ‚ö°</h1>

<button id="connectBtn" disabled>Loading Wallet...</button>

<button id="gmBtn" disabled>GM Ritual üåû</button>
<button id="gnBtn" disabled>GN Ritual üåô</button>
<button id="sleepBtn" disabled>GoSleep Ritual üò¥</button>

<a id="deployLink" href="/deploy">Deploy your contract üöÄ</a>

<script>
  const CONTRACT_ADDRESS = "0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A";
  const ABI = [
    "function gm() public",
    "function gn() public",
    "function gosleep() public"
  ];

  let web3Modal;
  let provider;
  let signer;
  let web3Provider;

  /* -------------------------------------------------- *
     ‚úÖ DELAYED INIT ‚Äî WAIT UNTIL ALL SCRIPTS LOADED
  * -------------------------------------------------- */
  async function initWeb3Modal() {
    if (!window.Web3Modal || !window.WalletConnectProvider) {
      console.log("‚è≥ scripts not ready, retrying...");
      return setTimeout(initWeb3Modal, 500);
    }

    console.log("‚úÖ Scripts loaded");

    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: {
          rpc: { 8453: "https://mainnet.base.org" },
          chainId: 8453
        }
      }
    };

    web3Modal = new Web3Modal.default({
      cacheProvider: false,
      providerOptions,
      theme: "dark"
    });

    console.log("‚úÖ Web3Modal ready");

    document.getElementById("connectBtn").disabled = false;
    document.getElementById("connectBtn").innerText = "Connect Wallet";
  }

  initWeb3Modal();


  /* -------------------------------------------------- *
      ‚úÖ CONNECT WALLET
  * -------------------------------------------------- */
  async function connectWallet() {
    if (!web3Modal) return alert("Wallet still loading...");

    try {
      provider = await web3Modal.connect();

      try {
        await provider.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x2105" }]
        });
      } catch {
        await provider.request({
          method: "wallet_addEthereumChain",
          params: [{
            chainId: "0x2105",
            chainName: "Base Mainnet",
            rpcUrls: ["https://mainnet.base.org"],
            nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 },
            blockExplorerUrls: ["https://basescan.org"]
          }]
        });
      }

      web3Provider = new ethers.providers.Web3Provider(provider);
      signer = web3Provider.getSigner();
      const address = await signer.getAddress();

      document.getElementById("connectBtn").innerText =
        "‚úÖ " + address.slice(0,6) + "..." + address.slice(-4);

      document.getElementById("gmBtn").disabled = false;
      document.getElementById("gnBtn").disabled = false;
      document.getElementById("sleepBtn").disabled = false;

    } catch (err) {
      alert("Connection failed: " + err.message);
    }
  }

  document.getElementById("connectBtn").onclick = connectWallet;



  /* -------------------------------------------------- *
      ‚úÖ Ritual Functions
  * -------------------------------------------------- */

  async function gm() {
    try {
      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      await contract.gm();
      alert("‚úÖ GM Ritual sent!");
    } catch (err) {
      alert("‚ùå Error: " + err.message);
    }
  }

  async function gn() {
    try {
      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      await contract.gn();
      alert("‚úÖ GN Ritual sent!");
    } catch (err) {
      alert("‚ùå Error: " + err.message);
    }
  }

  async function gosleep() {
    try {
      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      await contract.gosleep();
      alert("‚úÖ Sleep Ritual sent!");
    } catch (err) {
      alert("‚ùå Error: " + err.message);
    }
  }

  // Attach actions
  document.getElementById("gmBtn").onclick = gm;
  document.getElementById("gnBtn").onclick = gn;
  document.getElementById("sleepBtn").onclick = gosleep;

</script>

</body>
</html>
