<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GM Bandit</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, #0e172a, #1e293b, #334155);
      color: #f8fafc;
      text-align: center;
    }
    header {
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #logo {
      font-size: 26px;
      font-weight: 700;
    }
    #connectButton, #disconnectButton {
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      font-size: 15px;
      font-weight: 600;
      transition: 0.2s;
    }
    #connectButton {
      background: #3b82f6;
      color: white;
    }
    #connectButton:hover {
      background: #2563eb;
    }
    #disconnectButton {
      background: #ef4444;
      color: white;
      margin-left: 10px;
      display: none;
    }
    #main-buttons {
      margin-top: 100px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 80%;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    .action-btn {
      padding: 15px;
      border-radius: 10px;
      background: #475569;
      color: white;
      cursor: pointer;
      font-size: 18px;
      font-weight: 600;
      border: none;
      transition: 0.2s;
    }
    .action-btn:hover {
      background: #64748b;
    }
  </style>
</head>

<body>
<header>
  <div id="logo">GM Ritual</div>
  <div>
    <button id="connectButton">Connect Wallet</button>
    <button id="disconnectButton">Disconnect</button>
  </div>
</header>

<div id="main-buttons">
  <button class="action-btn" id="gmBtn">GM ðŸŒž</button>
  <button class="action-btn" id="gnBtn">GN ðŸŒ™</button>
  <button class="action-btn" id="sleepBtn">Go Sleep ðŸ˜´</button>
  <button class="action-btn" onclick="window.location='/deploy'">Deploy Ritual Contract ðŸ”®</button>
</div>

<script src="https://cdn.ethers.io/lib/ethers-6.3.0.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2/dist/umd/index.min.js"></script>

<script>
let provider = null;
let signerAddress = null;

// Base chain settings
const BASE_CHAIN_ID = 8453;
const CONTRACT = "0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A";

const ABI = [{
  "inputs":[{"internalType":"string","name":"newMessage","type":"string"}],
  "name":"performRitual",
  "outputs":[],
  "stateMutability":"payable",
  "type":"function"
}];

async function connectWallet() {
  try {
    provider = await window.WalletConnectEthereumProvider.init({
      projectId: "a3a3ba8ba4eaa7f69d0488d76a84b3df",
      chains: [BASE_CHAIN_ID],
      showQrModal: true,
    });

    await provider.connect();

    const accounts = await provider.request({ method: "eth_accounts" });
    signerAddress = accounts[0];

    const btn = document.getElementById("connectButton");
    btn.innerText = signerAddress.substring(0,6)+"..."+signerAddress.slice(-4);

    document.getElementById("disconnectButton").style.display = "inline-block";

  } catch(e) {
    alert("Connection failed: " + e.message);
  }
}

function disconnectWallet() {
  try {
    provider.disconnect();
  } catch(e){}
  provider = null;
  signerAddress = null;

  document.getElementById("connectButton").innerText = "Connect Wallet";
  document.getElementById("disconnectButton").style.display = "none";
}

// Encode ABI
function encodePayload(msg) {
  const iface = new ethers.Interface(ABI);
  return iface.encodeFunctionData("performRitual", [msg]);
}

async function sendRitual(text) {
  if (!provider || !signerAddress) {
    alert("Connect wallet first!");
    return;
  }

  const tx = {
    from: signerAddress,
    to: CONTRACT,
    data: encodePayload(text),
    value: "0x38D7EA4C68000" // 0.0001 ETH
  };

  try {
    const result = await provider.request({
      method: "eth_sendTransaction",
      params: [tx],
    });
    alert("Tx sent âœ…\n" + result);
  } catch(e) {
    alert("Transaction failed: " + e.message);
  }
}

document.getElementById("connectButton").onclick = connectWallet;
document.getElementById("disconnectButton").onclick = disconnectWallet;

document.getElementById("gmBtn").onclick = () => sendRitual("GM Ritual ðŸŒž");
document.getElementById("gnBtn").onclick = () => sendRitual("GN Ritual ðŸŒ™");
document.getElementById("sleepBtn").onclick = () => sendRitual("Go Sleep ðŸ˜´");
  </script>

<script src="https://cdn.ethers.io/lib/ethers-6.3.0.umd.min.js"></script>

</body>
</html>
