<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GM Ritual Dashboard âš¡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  padding: 0;
  background: #0d0d0d;
  color: white;
  text-align: center;
  font-family: Arial, sans-serif;
}
button {
  border: none;
  padding: 16px 28px;
  font-size: 20px;
  border-radius: 12px;
  cursor: pointer;
  width: 80%;
  margin: 14px auto;
  display: block;
  color: #fff;
}
#connectBtn { background: #1e5cff; }
#gmBtn { background: #005bbb; }
#gnBtn { background: #7b3ea9; }
#sleepBtn { background: #555; }

.disabled {
  opacity: 0.4;
  pointer-events: none;
}
</style>

<!-- WALLET CONNECT V2 -->
<script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>

</head>
<body>

<h1>GM Ritual Dashboard âš¡</h1>

<button id="connectBtn">Connect Wallet</button>
<button id="gmBtn" class="disabled">GM Ritual ðŸŒž</button>
<button id="gnBtn" class="disabled">GN Ritual ðŸŒ™</button>
<button id="sleepBtn" class="disabled">GoSleep Ritual ðŸ˜´</button>

<p><a href="deploy.html" style="color:#4da6ff; text-decoration:none;">Deploy your contract ðŸš€</a></p>

<script>
const BASE_CHAIN_ID_DEC = 8453;
const BASE_CHAIN_ID_HEX = "0x2105";
const BASE_RPC_URL = "https://mainnet.base.org";
const CONTRACT_ADDRESS = "0x0000000000000000000000000000000000000000"; // isi nanti

let provider = null;
let web3 = null;
let selectedAccount = null;

function showError(msg) { alert(msg); }

async function switchToBase() {
  if (!window.ethereum) return;

  try {
    await window.ethereum.request({
      method: "wallet_switchEthereumChain",
      params: [{ chainId: BASE_CHAIN_ID_HEX }]
    });
  } catch (switchError) {
    if (switchError.code === 4902) {
      try {
        await window.ethereum.request({
          method: "wallet_addEthereumChain",
          params: [{
            chainId: BASE_CHAIN_ID_HEX,
            chainName: "Base Mainnet",
            rpcUrls: [BASE_RPC_URL],
            blockExplorerUrls: ["https://basescan.org"],
            nativeCurrency: {
              name: "ETH",
              symbol: "ETH",
              decimals: 18
            }
          }]
        });
      } catch (addErr) {
        console.log(addErr);
      }
    } else {
      console.log(switchError);
    }
  }
}

async function connectWallet() {
  try {
    // DETECT metamask/okx/bitget
    if (window.ethereum) {
      provider = window.ethereum;
      await provider.request({ method: "eth_requestAccounts" });
      web3 = new Web3(provider);
      let accounts = await web3.eth.getAccounts();
      selectedAccount = accounts[0];

      await switchToBase();

      enableButtons();
      document.getElementById("connectBtn").innerHTML =
        "âœ… " + selectedAccount.slice(0,6) + "..." + selectedAccount.slice(-4);

    } else {
      // fallback WALLETCONNECT
      provider = new WalletConnectProvider.default({
        rpc: {
          8453: BASE_RPC_URL
        }
      });

      await provider.enable();
      web3 = new Web3(provider);

      let accounts = await web3.eth.getAccounts();
      selectedAccount = accounts[0];

      enableButtons();
      document.getElementById("connectBtn").innerHTML =
        "âœ… " + selectedAccount.slice(0,6) + "..." + selectedAccount.slice(-4);
    }
  } catch (err) {
    showError("Failed to connect wallet.\n" + err.message);
  }
}

function enableButtons() {
  document.getElementById("gmBtn").classList.remove("disabled");
  document.getElementById("gnBtn").classList.remove("disabled");
  document.getElementById("sleepBtn").classList.remove("disabled");
}

async function sendRitual(type) {
  if (!web3 || !selectedAccount) return showError("Wallet not connected!");

  try {
    alert(type + " Ritual executed! (dummy)");
    // placeholder â€” nanti diganti contract call
  } catch (err) {
    showError("Error calling ritual: " + err.message);
  }
}

// click events
document.getElementById("connectBtn").onclick = connectWallet;
document.getElementById("gmBtn").onclick = () => sendRitual("GM");
document.getElementById("gnBtn").onclick = () => sendRitual("GN");
document.getElementById("sleepBtn").onclick = () => sendRitual("GoSleep");
</script>

</body>
</html>
