<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GM Ritual Dashboard âš¡</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0; padding: 0;
  background: #0d0d0d; color: white; text-align: center;
  font-family: Arial, sans-serif;
}
button {
  width: 80%; padding: 16px; font-size: 20px;
  border-radius: 12px; border: none; margin: 14px auto;
  color: white; cursor: pointer; display: block;
}
#connectBtn { background: #1e5cff; }
#gmBtn { background: #005bbb; }
#gnBtn { background: #7b3ea9; }
#sleepBtn { background: #555; }
.disabled { opacity: 0.4; pointer-events: none; }
</style>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<script src="https://unpkg.com/@walletconnect/modal@2.6.0/dist/index.umd.min.js"></script>

</head>
<body>

<h1>GM Ritual Dashboard âš¡</h1>

<button id="connectBtn">Connect Wallet</button>
<button id="gmBtn" class="disabled">GM Ritual ðŸŒž</button>
<button id="gnBtn" class="disabled">GN Ritual ðŸŒ™</button>
<button id="sleepBtn" class="disabled">GoSleep Ritual ðŸ˜´</button>

<p><a href="deploy.html" style="color:#4da6ff;">Deploy your contract ðŸš€</a></p>

<script>
// ===================== âœ… CONTRACT DETAILS =====================
const CONTRACT_ADDRESS = "0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A";
const ABI = [
  {"inputs": [], "name": "gm", "outputs": [], "stateMutability": "nonpayable", "type": "function"},
  {"inputs": [], "name": "gn", "outputs": [], "stateMutability": "nonpayable", "type": "function"},
  {"inputs": [], "name": "sleep", "outputs": [], "stateMutability": "nonpayable", "type": "function"}
];

const BASE_CHAIN_HEX = "0x2105"; // 8453 Base mainnet
let provider;
let signer;
let modal;

// âœ… WalletConnect v2 Modal Init
modal = new WalletConnectModal.default({
  projectId: "24b960bbcb9fa912923190d9ce99ed92",
  walletConnectVersion: 2,
  themeMode: "dark",
});

// âœ… Connect Wallet
async function connect() {
  try {
    const session = await modal.openModal({
      chains: [8453], // Base
    });

    const wcProvider = new ethers.providers.Web3Provider(session);
    provider = wcProvider;
    signer = wcProvider.getSigner();
    const addr = await signer.getAddress();

    document.getElementById("connectBtn").innerHTML =
      "âœ… " + addr.slice(0, 6) + "..." + addr.slice(-4);

    enableButtons();

  } catch (err) {
    alert("Connection failed: " + err.message);
  }
}

// âœ… Enable Ritual Buttons After Connect
function enableButtons() {
  document.getElementById("gmBtn").classList.remove("disabled");
  document.getElementById("gnBtn").classList.remove("disabled");
  document.getElementById("sleepBtn").classList.remove("disabled");
}

// âœ… Ritual Execution
async function ritual(type) {
  if (!signer) return alert("Connect wallet dulu bro!");

  try {
    const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
    let tx;

    if (type === "GM") tx = await contract.gm();
    if (type === "GN") tx = await contract.gn();
    if (type === "Sleep") tx = await contract.sleep();

    alert(type + " Ritual TX sent âœ…\nTX Hash:\n" + tx.hash);

  } catch (e) {
    alert("Error: " + e.message);
  }
}

// âœ… Button Listeners
document.getElementById("connectBtn").onclick = connect;
document.getElementById("gmBtn").onclick = () => ritual("GM");
document.getElementById("gnBtn").onclick = () => ritual("GN");
document.getElementById("sleepBtn").onclick = () => ritual("Sleep");

</script>

</body>
</html>
