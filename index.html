<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GM Ritual â€¢ On Base</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="data:," />

  <style>
    :root{
      --bg:#0f1115; --card:#161a22; --text:#e9eefb; --muted:#9aa4b2;
      --blue:#2563eb; --purple:#7c3aed; --slate:#334155; 
      --green:#16a34a; --red:#ef4444;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial}
    body {
  margin: 0;
  background: linear-gradient(180deg, #1E3A8A 0%, #60A5FA 50%, #ffffff 100%);
  color: var(--text);
    }
    .wrap{max-width:880px;margin:48px auto;padding:0 16px;text-align:center}
    h1{font-size:38px;margin:0 0 6px}
    .sub {
  color: #1f2937;
  margin-bottom: 32px;
}

    .card{
      background: rgba(22, 26, 34, 0.85); /* semi transparan */
      border: 1px solid #1f2430;
      border-radius: 16px;
      padding: 24px;
    }

    .row{display:flex;gap:14px;flex-wrap:wrap;justify-content:center}
    button{cursor:pointer;border:0;border-radius:12px;padding:14px 18px;font-weight:600;transition:.15s}
    .btn{min-width:220px}
    .primary{background:var(--blue);color:#fff}
    .danger{background:var(--red);color:#fff}
    .gm{background:#1d4ed8;color:#fff}
    .gn{background:#6d28d9;color:#fff}
    .sleep{background:#374151;color:#cbd5e1}
    .disabled{opacity:.55;pointer-events:none}

    .chip{
      display:inline-flex;align-items:center;gap:8px;
      background:#0b1324;border:1px solid #1f2a44;
      color:#cfe0ff;padding:10px 12px;border-radius:12px;font-size:14px
    }
    .chip .dot{width:8px;height:8px;border-radius:999px;background:#16a34a;display:inline-block}
    .foot{color:var(--muted);font-size:13px;margin-top:22px}
    a.link{color:#7aa2ff;text-decoration:none}
  </style>

  <!-- Ethers.js v5 (paling kompatibel semua dApp browser mobile) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

</head>
<body>
  <div class="wrap">
      <!-- âœ… BANNER -->
  <img src="assets/gmbandit.jpg" alt="GMbandit Banner" style="max-width:100%;border-radius:12px;margin-bottom:12px" />

   <div style="font-size:12px; opacity:0.6; margin-bottom:12px;">
  Rituals on Base â€¢ Fee: 0.00000033 ETH
</div>

    <div class="card">

      <div class="row" style="margin-bottom:12px;">
        <button id="connectBtn" class="btn primary">Connect Wallet</button>
        <button id="disconnectBtn" class="btn danger disabled">Disconnect</button>
      </div>

      <div id="addrBar" style="margin:12px 0 18px;display:none;">
        <span class="chip"><span class="dot"></span><span id="addrShort">0xâ€¦</span></span>
      </div>

      <div class="row" style="margin-top:4px;">
        <button id="gmBtn" class="btn gm disabled">GM Ritual ðŸŒž</button>
        <button id="gnBtn" class="btn gn disabled">GN Ritual ðŸŒ™</button>
        <button id="sleepBtn" class="btn sleep disabled">GoSleep ðŸ˜´</button>
      </div>

      <div class="foot">
        Want your own contract? <a class="link" onclick="alert('Deploy feature coming soon ðŸš§'); return false;">
  Deploy (Coming Soon) ðŸš§
</a>
      </div>
    </div>
  </div>

<script>
(() => {
  // ====== CONFIG ======
  const CONTRACT = "0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A";
  const ABI = [
    "function performRitual(string calldata newMessage) external payable",
    "function fee() view returns (uint256)"
  ];
  const BASE_CHAIN = "0x2105";

  // ===== UI helpers =======
  const $ = (id)=>document.getElementById(id);
  const connectBtn = $("connectBtn");
  const disconnectBtn = $("disconnectBtn");
  const gmBtn = $("gmBtn");
  const gnBtn = $("gnBtn");
  const sleepBtn = $("sleepBtn");
  const addrBar = $("addrBar");
  const addrShort = $("addrShort");

  let provider, signer, account;

  function short(a){return a?a.slice(0,6)+"â€¦"+a.slice(-4):"";}
  function setDisabled(el,bool){el.classList.toggle("disabled",bool);}

  function showConnected(addr){
    connectBtn.textContent="Connected âœ…";
    setDisabled(connectBtn,true);
    setDisabled(disconnectBtn,false);
    addrBar.style.display="block";
    addrShort.textContent = short(addr);
    refreshButtons();
  }

  function showDisconnected(){
    connectBtn.textContent="Connect Wallet";
    setDisabled(connectBtn,false);
    setDisabled(disconnectBtn,true);
    addrBar.style.display="none";
    setDisabled(gmBtn,true);
    setDisabled(gnBtn,true);
    setDisabled(sleepBtn,true);
  }

  // ========= Cooldown (per tombol per hari) =========

  function key(type){
    return "cool_"+type+"_"+account;
  }

  function checkCooldown(type){
    if (!account) return true;
    const saved = localStorage.getItem(key(type));
    if (!saved) return false;
    const today = new Date().toISOString().slice(0,10);
    return saved === today;
  }

  function mark(type){
    const today = new Date().toISOString().slice(0,10);
    localStorage.setItem(key(type), today);
  }

  function refreshButtons(){
    setDisabled(gmBtn, checkCooldown("GM"));
    setDisabled(gnBtn, checkCooldown("GN"));
    setDisabled(sleepBtn, checkCooldown("SLEEP"));
  }

  // ========= Chain switch ==========
  async function ensureBase(){
    const eth = window.ethereum || window.okxwallet || window.bitgetwallet || (window.bitkeep && window.bitkeep.ethereum);
    if (!eth) throw new Error("No wallet detected. Please use MetaMask/OKX/Bitget dApp browser.");
    const chainId = await eth.request({method:"eth_chainId"});
    if (chainId === BASE_CHAIN) return;

    // Try switch
    try {
      await eth.request({
        method:"wallet_switchEthereumChain",
        params:[{chainId:BASE_CHAIN}]
      });
    } catch(e){
      if (e.code===4902){
        await eth.request({
          method:"wallet_addEthereumChain",
          params:[{
            chainId: BASE_CHAIN,
            chainName:"Base",
            rpcUrls:["https://mainnet.base.org"],
            nativeCurrency:{name:"Base Ether",symbol:"ETH",decimals:18},
            blockExplorerUrls:["https://basescan.org"]
          }]
        });
      } else {
        throw e;
      }
    }
  }

  // ========= Connect ==========
  async function connect(){
    try{
      const eth = window.ethereum || window.okxwallet || window.bitgetwallet || (window.bitkeep && window.bitkeep.ethereum);
      if (!eth){ alert("Wallet not detected. Use MetaMask/OKX/Bitget dApp browser."); return; }

      await ensureBase();

      provider = new ethers.providers.Web3Provider(eth,"any");
      await provider.send("eth_requestAccounts",[]);
      signer = provider.getSigner();
      account = await signer.getAddress();

      showConnected(account);

      eth.on?.("accountsChanged",(acc)=>{
        if(!acc || acc.length===0){disconnect();return;}
        account = acc[0];
        addrShort.textContent = short(account);
        refreshButtons();
      });
      eth.on?.("chainChanged",(c)=>{
        if(c!==BASE_CHAIN){ showDisconnected(); }
      });

    }catch(e){
      console.error(e);
      showDisconnected();
      alert("Connection failed âŒ");
    }
  }

  // ========= Disconnect ==========
  function disconnect(){
    provider=null; signer=null; account=null;
    showDisconnected();
  }

  // ========= Ritual ==========
  async function ritual(type,message){
    if(checkCooldown(type)){
      alert("You already did "+type+" today âœ…");
      return;
    }
    
    try{
      await ensureBase();
      const c = new ethers.Contract(CONTRACT, ABI, signer);
      const fee = await c.fee();
      const tx = await c.performRitual(message,{value:fee});
      alert("TX sentâ€¦ waiting confirmation");
      await tx.wait();
      mark(type);
      refreshButtons();
      alert(type+" ritual complete âœ…");
    }catch(err){
      console.error(err);
      alert("Ritual failed âŒ");
    }
  }

  // ===== Bind =======
  connectBtn.onclick = connect;
  disconnectBtn.onclick = disconnect;
  gmBtn.onclick = ()=>ritual("GM","GM âš¡");
  gnBtn.onclick = ()=>ritual("GN","GN ðŸŒ™");
  sleepBtn.onclick = ()=>ritual("SLEEP","GoSleep ðŸ˜´");

  // initial
  showDisconnected();
})();
</script>

<hr style="border: 0; border-top: 2px double #334155; margin: 40px 0;" />
  
<footer style="text-align:center; font-size:14px; color:#9aa4b2; padding-bottom:32px">
  ðŸŸ¦ Built with love by <strong>Bandit Skuad</strong> <br/>
  Contract: 
  <a href="https://basescan.org/address/0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A" style="color:#7aa2ff" target="_blank">
    Ritual Contract
  </a> | 
  <a href="https://basescan.org/address/0xb9C0b964E223D0058cdFEB445B4506415117b055" style="color:#7aa2ff" target="_blank">
    Factory Contract
  </a> <br/><br/>
  
  ðŸ‘‰ Follow us: 
  <a href="https://warpcast.com/banditi" target="_blank" style="color:#7aa2ff">Farcaster</a> â€¢ 
  <a href="https://x.com/Alidepok1" target="_blank" style="color:#7aa2ff">X (Twitter)</a> â€¢ 
  <a href="https://github.com/beny25" target="_blank" style="color:#7aa2ff">GitHub</a>
  
  <br/><br/>
  <span style="font-size:12px;color:#5c677a;">Â© 2025 GMbandit on Base â†’ Open Source & Ritual Ready</span>
</footer>
  
</body>
</html>
