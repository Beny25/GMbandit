<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>GM Ritual Dashboard ‚ö°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #0d0d0d;
      color: white;
      text-align: center;
    }

    h1 {
      font-size: 32px;
      margin-top: 40px;
      margin-bottom: 20px;
    }

    button {
      padding: 14px 28px;
      border-radius: 12px;
      border: none;
      font-size: 18px;
      cursor: pointer;
      margin: 12px;
      width: 80%;
      max-width: 350px;
      transition: 0.2s;
    }

    #connectBtn {
      background: #007bff;
      color: white;
    }

    #connectBtn:hover {
      background: #0066d4;
    }

    #gmBtn {
      background: #1e90ff;
      color: white;
    }

    #gnBtn {
      background: #9b59b6;
      color: white;
    }

    #sleepBtn {
      background: #2c2c2c;
      color: white;
    }

    #deployLink {
      color: #8ab4f8;
      font-size: 18px;
      text-decoration: underline;
      margin-top: 30px;
      display: inline-block;
    }
  </style>
</head>

<body>

  <h1>GM Ritual Dashboard ‚ö°</h1>

  <button id="connectBtn" onclick="connectWallet()">Connect Wallet</button>

  <button id="gmBtn" disabled onclick="gmRitual()">GM Ritual ‚òÄÔ∏è</button>
  <button id="gnBtn" disabled onclick="gnRitual()">GN Ritual üåô</button>
  <button id="sleepBtn" disabled onclick="sleepRitual()">GoSleep Ritual üò¥</button>

  <br><br>
  <a id="deployLink" href="/deploy">Deploy your contract üöÄ</a>

  <!-- ‚úÖ Ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <!-- ‚úÖ WalletConnect Universal Provider (mobile-safe) -->
  <script src="https://unpkg.com/@walletconnect/universal-provider/dist/umd/index.min.js"></script>

  <script>
    const CONTRACT_ADDRESS = "0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A"; // gmbanditv2
    let provider = null;
    let signer = null;
    let userAddress = null;

    // ‚úÖ ABI minimal
    const ABI = [
      "function gm() public",
      "function gn() public",
      "function gosleep() public"
    ];

    async function connectWallet() {
      try {
        const UniversalProvider = window.WalletConnectUniversalProvider.default;

        provider = await UniversalProvider.init({
          projectId: "48a2d3a850eb798ae0c8641887fea44f", // ‚úÖ secure & working
          metadata: {
            name: "GM-Bandit Ritual",
            description: "Dashboard for GM Ritual",
            url: "https://gm-bandit.vercel.app",
            icons: ["https://gm-bandit.vercel.app/logo.png"]
          }
        });

        const session = await provider.connect({
          namespaces: {
            eip155: {
              methods: ["eth_sendTransaction"],
              chains: ["eip155:8453"],
              rpcMap: {
                8453: "https://mainnet.base.org"
              }
            }
          }
        });

        const account = session.namespaces.eip155.accounts[0].split(":")[2];
        userAddress = account;

        document.getElementById("connectBtn").innerText =
          "‚úÖ " + account.slice(0, 6) + "..." + account.slice(-4);

        // ‚úÖ Enable action buttons
        document.getElementById("gmBtn").disabled = false;
        document.getElementById("gnBtn").disabled = false;
        document.getElementById("sleepBtn").disabled = false;

        // ‚úÖ convert provider to ethers provider
        const ethersProvider = new ethers.providers.Web3Provider(provider);
        signer = ethersProvider.getSigner();

      } catch (err) {
        alert("Connection failed: " + err.message);
      }
    }

    async function gmRitual() {
      if (!signer) return alert("Connect wallet first!");

      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      try {
        await contract.gm();
        alert("‚úÖ GM Ritual executed!");
      } catch (err) {
        alert("Transaction failed: " + err.message);
      }
    }

    async function gnRitual() {
      if (!signer) return alert("Connect wallet first!");

      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      try {
        await contract.gn();
        alert("‚úÖ GN Ritual executed!");
      } catch (err) {
        alert("Transaction failed: " + err.message);
      }
    }

    async function sleepRitual() {
      if (!signer) return alert("Connect wallet first!");

      const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
      try {
        await contract.gosleep();
        alert("‚úÖ GoSleep Ritual executed!");
      } catch (err) {
        alert("Transaction failed: " + err.message);
      }
    }
  </script>
</body>

</html>
