<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Deploy GMbandit Contract</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#0d1117;color:#fff;font-family:Arial;text-align:center;padding:20px}
.card{background:#161b22;border:1px solid #233044;border-radius:12px;padding:20px;max-width:400px;margin:auto}
button{padding:12px 16px;border:0;border-radius:10px;font-size:16px;font-weight:bold;cursor:pointer;margin-top:10px}
.primary{background:#1d4ed8;color:#fff}
.disabled{opacity:.4;pointer-events:none}
</style>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>

<h1>Deploy GMbandit üöÄ</h1>

<div class="card">
  <p id="status">Please connect wallet</p>
  <button id="connectBtn" class="primary">Connect Wallet</button>
  <button id="deployBtn" class="primary disabled">Deploy Contract</button>
</div>

<script>
(async()=>{
  const FACTORY_ADDRESS = "0xb9C0b964E223D0058cdFEB445B4506415117b055";

  // ‚úÖ ABI based on screenshot
  const ABI = [
    "function deployGMbandit(address ownerAddress, address collectorAddress) returns(address)"
  ];

  const BASE_HEX = "0x2105";

  const COLLECTOR = "0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A"; // ‚úÖ your collector

  let provider, signer, account;

  const status = document.getElementById("status");
  const connectBtn = document.getElementById("connectBtn");
  const deployBtn  = document.getElementById("deployBtn");

  async function ensureBase(eth){
    const id = await eth.request({method:"eth_chainId"});
    if(id !== BASE_HEX){
      try{
        await eth.request({method:"wallet_switchEthereumChain", params:[{chainId:BASE_HEX}]});
      }catch{
        alert("Switch to Base manually");
        throw "wrong network";
      }
    }
  }

  async function connect(){
    const eth = window.ethereum || window.okxwallet || window.bitgetwallet || (window.bitkeep && window.bitkeep.ethereum);
    if(!eth){ alert("No wallet detected"); return; }

    await ensureBase(eth);

    provider = new ethers.providers.Web3Provider(eth);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    account = await signer.getAddress();

    status.innerText = "Connected ‚úÖ " + account;
    connectBtn.classList.add("disabled");
    deployBtn.classList.remove("disabled");
  }

  async function deploy(){
    try{
      const factory = new ethers.Contract(FACTORY_ADDRESS, ABI, signer);

      status.innerText = "Sending transaction‚Ä¶";

      // ‚úÖ CALL exactly matched function signature
      const tx = await factory.deployGMbandit(account, COLLECTOR);

      status.innerText = "Waiting confirmation‚Ä¶";
      const receipt = await tx.wait();

      alert("Deployed ‚úÖ TX: " + tx.hash);
      status.innerText = "Deployed ‚úÖ address: " + receipt.logs[0].address;

    }catch(err){
      console.error(err);
      status.innerText = "Deploy failed ‚ùå";
      alert("Deploy failed ‚ùå");
    }
  }

  connectBtn.onclick = connect;
  deployBtn.onclick = deploy;

})();
</script>

<hr style="border: 0; height: 1px; background: #2c2f36; margin: 48px 0 24px;" />

<footer style="text-align:center; font-size:14px; color:#9aa4b2; padding-bottom:32px">
  üöÄ Built with love by <strong>Bandit Skuad</strong> <br/>
  Contract: 
  <a href="https://basescan.org/address/0x725Ccb4ddCB715f468b301395Dfd1b1efDb5308A" style="color:#7aa2ff" target="_blank">
    Ritual Contract
  </a> | 
  <a href="https://basescan.org/address/0xb9C0b964E223D0058cdFEB445B4506415117b055" style="color:#7aa2ff" target="_blank">
    Factory Contract
  </a> <br/><br/>
  
  üëâ Follow us: 
  <a href="https://warpcast.com/banditi" target="_blank" style="color:#7aa2ff">Farcaster</a> ‚Ä¢ 
  <a href="https://x.com/Alidepok1" target="_blank" style="color:#7aa2ff">X (Twitter)</a> ‚Ä¢ 
  <a href="https://github.com/beny25/GMbandit" target="_blank" style="color:#7aa2ff">GitHub</a>
  
  <br/><br/>
  <span style="font-size:12px;color:#5c677a;">¬© 2025 GMbandit on Base ‚Äî Open Source & Ritual Ready</span>
</footer>
  
</body>
</html>
